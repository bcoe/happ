{"version":3,"file":"metrics-CZO-FXyB.js","sources":["../../../app/providers/metrics.tsx"],"sourcesContent":["import * as React from \"react\";\n\nexport interface MetricType {\n  daily: Array<{\n    name: string;\n    completed: number;\n  }>\n}\n\nexport interface NoteTableRow {\n  note: string;\n  date: string;\n  highlight: boolean;\n}\n\ninterface MetricsType {\n  metrics: MetricType; \n  notes: Array<NoteTableRow>,\n  load: () => Promise<void>;\n  set: (metrics: MetricType) => void;\n  maybeSelectRow: (date: string) => void;\n  lostFocus: () => void;\n  gotFocus: () => void;\n}\n\nconst MetricsContext = React.createContext<MetricsType>(null!);\n\nexport function MetricsProvider({ children }: { children: React.ReactNode }) {\n  const [metrics, setMetrics] =  React.useState<MetricType>({daily: []});\n  const [notes, setNotes] = React.useState<Array<NoteTableRow>>([]);\n  const [selectedDate, setSelectedDate] = React.useState<string>('');\n  const [hasFocus, setHasFocus] = React.useState<boolean>(false);\n\n  const set = (metrics: MetricType) => {\n    setMetrics(metrics);\n    return {};\n  }\n\n  const loadNotes = async () => {\n    const resp = await fetch(\"/v1/notes\");\n    const n = await resp.json();\n    setNotes(n.map((n) => {\n      return {\n        note: n.note,\n        date: n.date,\n        highlight: false\n      }\n    }));\n  }\n\n  const load = async () => {\n    const resp = await fetch(\"/v1/metrics\");\n    const m = await resp.json();\n    set({daily: m.map((item) => {\n      const date = (new Date(item.date)).toISOString().split('T')[0];\n      return {\n        name: date,\n        completed: item.total_habits_for_day ? (item.habits_completed / item.total_habits_for_day) : 0\n      }\n    })});\n    await loadNotes();\n  }\n\n  const maybeSelectRow = async (date: string) => {\n    if (date === selectedDate || hasFocus === false) return;\n    else setSelectedDate(date);\n    if (date !== selectedDate) {\n      setNotes(notes.map((n) => {\n        return {\n          note: n.note,\n          date: n.date,\n          highlight: n.date === date\n        };\n      }))\n    }\n  };\n\n  const gotFocus = async () => {\n    if (hasFocus === true) return;\n    setHasFocus(true);\n  };\n\n  const lostFocus = async () => {\n    if (hasFocus === false) return;\n    else setHasFocus(false);\n    setSelectedDate('');\n    setNotes(notes.map((n) => {\n      return {\n        note: n.note,\n        date: n.date,\n        highlight: false\n      };\n    }));\n  };\n\n  const value = { metrics, notes, load, set, maybeSelectRow, gotFocus, lostFocus };\n\n  return <MetricsContext.Provider value={value}>{children}</MetricsContext.Provider>;\n}\n\nexport function useMetrics() {\n  return React.useContext(MetricsContext);\n}\n"],"names":["MetricsContext","React.createContext","MetricsProvider","children","metrics","setMetrics","React.useState","notes","setNotes","selectedDate","setSelectedDate","hasFocus","setHasFocus","set","loadNotes","n","value","m","item","date","jsx","useMetrics","React.useContext"],"mappings":"4WAyBA,MAAMA,EAAiBC,EAAAA,cAAiC,IAAK,EAE7C,SAAAC,EAAgB,CAAE,SAAAC,GAA2C,CACrE,KAAA,CAACC,EAASC,CAAU,EAAKC,WAA2B,CAAC,MAAO,CAAC,CAAA,CAAE,EAC/D,CAACC,EAAOC,CAAQ,EAAIF,EAAM,SAA8B,CAAE,CAAA,EAC1D,CAACG,EAAcC,CAAe,EAAIJ,WAAuB,EAAE,EAC3D,CAACK,EAAUC,CAAW,EAAIN,WAAwB,EAAK,EAEvDO,EAAOT,IACXC,EAAWD,CAAO,EACX,IAGHU,EAAY,SAAY,CAEtB,MAAAC,EAAI,MADG,MAAM,MAAM,WAAW,GACf,OACZP,EAAAO,EAAE,IAAKA,IACP,CACL,KAAMA,EAAE,KACR,KAAMA,EAAE,KACR,UAAW,EAAA,EAEd,CAAC,CAAA,EAgDEC,EAAQ,CAAE,QAAAZ,EAAS,MAAAG,EAAO,KA7CnB,SAAY,CAEjB,MAAAU,EAAI,MADG,MAAM,MAAM,aAAa,GACjB,OACrBJ,EAAI,CAAC,MAAOI,EAAE,IAAKC,IAEV,CACL,KAFY,IAAI,KAAKA,EAAK,IAAI,EAAG,YAAA,EAAc,MAAM,GAAG,EAAE,CAAC,EAG3D,UAAWA,EAAK,qBAAwBA,EAAK,iBAAmBA,EAAK,qBAAwB,CAAA,EAEhG,CAAE,CAAA,EACH,MAAMJ,EAAU,CAAA,EAmCoB,IAAAD,EAAK,eAhCpB,MAAOM,GAAiB,CACzCA,IAASV,GAAgBE,IAAa,KACrCD,EAAgBS,CAAI,EACrBA,IAASV,GACFD,EAAAD,EAAM,IAAKQ,IACX,CACL,KAAMA,EAAE,KACR,KAAMA,EAAE,KACR,UAAWA,EAAE,OAASI,CAAA,EAEzB,CAAC,EACJ,EAqByD,SAlB1C,SAAY,CACvBR,IAAa,IACjBC,EAAY,EAAI,CAAA,EAgBmD,UAbnD,SAAY,CACxBD,IAAa,KACZC,EAAY,EAAK,EACtBF,EAAgB,EAAE,EACTF,EAAAD,EAAM,IAAKQ,IACX,CACL,KAAMA,EAAE,KACR,KAAMA,EAAE,KACR,UAAW,EAAA,EAEd,CAAC,EAAA,GAKJ,OAAQK,EAAAA,IAAApB,EAAe,SAAf,CAAwB,MAAAgB,EAAe,SAAAb,CAAS,CAAA,CAC1D,CAEO,SAASkB,GAAa,CACpB,OAAAC,EAAAA,WAAiBtB,CAAc,CACxC"}