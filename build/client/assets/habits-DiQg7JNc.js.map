{"version":3,"file":"habits-DiQg7JNc.js","sources":["../../../app/providers/habits.tsx"],"sourcesContent":["import * as React from \"react\";\n\nexport type DayToggles = {\n  Mon: boolean;\n  Tue: boolean;\n  Wed: boolean;\n  Thu: boolean;\n  Fri: boolean;\n  Sat: boolean;\n  Sun: boolean;\n};\n\nexport const NO_DAYS_SET = {\n  Mon: false,\n  Tue: false,\n  Wed: false,\n  Thu: false,\n  Fri: false,\n  Sat: false,\n  Sun: false\n};\n\nexport const ALL_DAYS_SET = {\n  Mon: true,\n  Tue: true,\n  Wed: true,\n  Thu: true,\n  Fri: true,\n  Sat: true,\n  Sun: true\n};\n\nexport interface HabitType {\n  name: string;\n  days: DayToggles,\n  habit_id: string;\n  id: string;\n  status: boolean;\n  date: string;\n}\n\nexport interface HabitResponse {\n  current_dow: string;\n  habits: Array<HabitType>;\n}\n\ninterface HabitsType {\n  habits: Array<HabitType>; \n  empty: boolean;\n  currentDayOfWeek: string;\n  editing: boolean;\n  currentlyEditing?: HabitType;\n  setEditing: (editing: boolean, id: string | undefined) => Promise<void>;\n  load: () => Promise<void>;\n  create: (name: string, days: DayToggles) => Promise<void>;\n  update: (id: string, name: string, days: DayToggles) => Promise<void>;\n  set: (habits: HabitResponse) => {};\n  toggle: (id: string) => Promise<void>;\n  move: (oldIndex: number, newIndex: number) => Promise<void>;\n}\n\nconst HabitsContext = React.createContext<HabitsType>(null!);\n\nexport function HabitsProvider({ children }: { children: React.ReactNode }) {\n  const [habits, setHabits] = React.useState<Array<HabitType>>([]);\n  const [empty, setEmpty] = React.useState<boolean>(false);\n  const [currentDayOfWeek, setCurrentDayOfWeek] = React.useState<string>('');\n  const [editing, _setEditing] = React.useState<boolean>(false);\n  const [currentlyEditing, setCurrentlyEditing] = React.useState<HabitType | undefined>(undefined);\n\n  const set = (habits: HabitResponse) => {\n    setHabits([...habits.habits]);\n    setEmpty(!habits.habits.length);\n    setCurrentDayOfWeek(habits.current_dow);\n    return {}\n  }\n\n  const create = async (name: string, days: DayToggles) => {\n    let hasDaysSet = false;\n    for (const toggle of Object.values(days)) {\n      if (toggle) hasDaysSet = true;\n    }\n    await fetch('/v1/habits', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({name, days: hasDaysSet ? days : undefined})\n    });\n  }\n\n  const update = async (id: string, name: string, days: DayToggles) => {\n    let hasDaysSet = false;\n    for (const toggle of Object.values(days)) {\n      if (toggle) hasDaysSet = true;\n    }\n    await fetch(`/v1/habits/${id}`, {\n      method: 'PUT',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({name, days: hasDaysSet ? days : ALL_DAYS_SET})\n    });\n  }\n\n  const toggle = async (id: string) => {\n    const habit = habits.find((h) => {\n      if (h.id === id) return true;\n    })\n    if (!habit) return;\n    await fetch('/v1/habits-daily', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        habit_id: habit.habit_id,\n        status: !habit.status,\n        date: habit.date,\n      })\n    });\n  }\n\n  const move = async (oldIndex: number, newIndex: number) => {\n    await fetch('/v1/habits/array-move', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        oldIndex,\n        newIndex\n      })\n    });\n  }\n\n  const load = async () => {\n    const resp = await fetch(\"/v1/habits-daily\");\n    const habits = await resp.json();\n    habits.habits.map((h) => {\n      h.id = h.habit_id;\n    });\n    set(habits);\n  }\n\n  const setEditing = async (editing: boolean, id: string | undefined) => {\n    if (id) {\n      setCurrentlyEditing(habits.find(h => {\n        return h.id === id;\n      }));\n    } else {\n      setCurrentlyEditing(undefined);\n    }\n    _setEditing(editing);\n  }\n\n  const value = { habits, empty, currentDayOfWeek, editing, setEditing, currentlyEditing, load, set, create, update, toggle, move };\n\n  return <HabitsContext.Provider value={value}>{children}</HabitsContext.Provider>;\n}\n\nexport function useHabits() {\n  return React.useContext(HabitsContext);\n}\n"],"names":["NO_DAYS_SET","ALL_DAYS_SET","HabitsContext","React.createContext","HabitsProvider","children","habits","setHabits","React.useState","empty","setEmpty","currentDayOfWeek","setCurrentDayOfWeek","editing","_setEditing","currentlyEditing","setCurrentlyEditing","set","value","id","h","name","days","hasDaysSet","toggle","habit","oldIndex","newIndex","jsx","useHabits","React.useContext"],"mappings":"4WAYO,MAAMA,EAAc,CACzB,IAAK,GACL,IAAK,GACL,IAAK,GACL,IAAK,GACL,IAAK,GACL,IAAK,GACL,IAAK,EACP,EAEaC,EAAe,CAC1B,IAAK,GACL,IAAK,GACL,IAAK,GACL,IAAK,GACL,IAAK,GACL,IAAK,GACL,IAAK,EACP,EA+BMC,EAAgBC,EAAAA,cAAgC,IAAK,EAE3C,SAAAC,EAAe,CAAE,SAAAC,GAA2C,CAC1E,KAAM,CAACC,EAAQC,CAAS,EAAIC,EAAM,SAA2B,CAAE,CAAA,EACzD,CAACC,EAAOC,CAAQ,EAAIF,WAAwB,EAAK,EACjD,CAACG,EAAkBC,CAAmB,EAAIJ,WAAuB,EAAE,EACnE,CAACK,EAASC,CAAW,EAAIN,WAAwB,EAAK,EACtD,CAACO,EAAkBC,CAAmB,EAAIR,EAAAA,SAAsC,MAAS,EAEzFS,EAAOX,IACXC,EAAU,CAAC,GAAGD,EAAO,MAAM,CAAC,EACnBI,EAAA,CAACJ,EAAO,OAAO,MAAM,EAC9BM,EAAoBN,EAAO,WAAW,EAC/B,IAkFHY,EAAQ,CAAE,OAAAZ,EAAQ,MAAAG,EAAO,iBAAAE,EAAkB,QAAAE,EAAS,WAXvC,MAAOA,EAAkBM,IAA2B,CAE/CH,EADlBG,EACkBb,EAAO,KAAUc,GAC5BA,EAAE,KAAOD,CACjB,EAEmB,MAFlB,EAIJL,EAAYD,CAAO,CAAA,EAGiD,iBAAAE,EAAkB,KApB3E,SAAY,CAEjBT,MAAAA,EAAS,MADF,MAAM,MAAM,kBAAkB,GACjB,OAC1BA,EAAO,OAAO,IAAKc,GAAM,CACvBA,EAAE,GAAKA,EAAE,QAAA,CACV,EACDH,EAAIX,CAAM,CAAA,EAckF,IAAAW,EAAK,OA/EpF,MAAOI,EAAcC,IAAqB,CACvD,IAAIC,EAAa,GACjB,UAAWC,KAAU,OAAO,OAAOF,CAAI,EACjCE,IAAqBD,EAAA,IAE3B,MAAM,MAAM,aAAc,CACxB,OAAQ,OACR,QAAS,CACP,eAAgB,kBAClB,EACA,KAAM,KAAK,UAAU,CAAC,KAAAF,EAAM,KAAME,EAAaD,EAAO,OAAU,CAAA,CACjE,CAAA,EAoEwG,OAjE5F,MAAOH,EAAYE,EAAcC,IAAqB,CACnE,IAAIC,EAAa,GACjB,UAAWC,KAAU,OAAO,OAAOF,CAAI,EACjCE,IAAqBD,EAAA,IAErB,MAAA,MAAM,cAAcJ,CAAE,GAAI,CAC9B,OAAQ,MACR,QAAS,CACP,eAAgB,kBAClB,EACA,KAAM,KAAK,UAAU,CAAC,KAAAE,EAAM,KAAME,EAAaD,EAAOrB,EAAa,CAAA,CACpE,CAAA,EAsDgH,OAnDpG,MAAOkB,GAAe,CACnC,MAAMM,EAAQnB,EAAO,KAAMc,GAAM,CAC/B,GAAIA,EAAE,KAAOD,EAAW,MAAA,EAAA,CACzB,EACIM,GACL,MAAM,MAAM,mBAAoB,CAC9B,OAAQ,OACR,QAAS,CACP,eAAgB,kBAClB,EACA,KAAM,KAAK,UAAU,CACnB,SAAUA,EAAM,SAChB,OAAQ,CAACA,EAAM,OACf,KAAMA,EAAM,IAAA,CACb,CAAA,CACF,CAAA,EAoCwH,KAjC9G,MAAOC,EAAkBC,IAAqB,CACzD,MAAM,MAAM,wBAAyB,CACnC,OAAQ,OACR,QAAS,CACP,eAAgB,kBAClB,EACA,KAAM,KAAK,UAAU,CACnB,SAAAD,EACA,SAAAC,CAAA,CACD,CAAA,CACF,CAAA,CAuB6H,EAEhI,OAAQC,EAAAA,IAAA1B,EAAc,SAAd,CAAuB,MAAAgB,EAAe,SAAAb,CAAS,CAAA,CACzD,CAEO,SAASwB,GAAY,CACnB,OAAAC,EAAAA,WAAiB5B,CAAa,CACvC"}