{"version":3,"file":"habits-CpAXl-tC.js","sources":["../../../app/providers/habits.tsx"],"sourcesContent":["import * as React from \"react\";\n\nexport type DayToggles = {\n  Mon: boolean;\n  Tue: boolean;\n  Wed: boolean;\n  Thu: boolean;\n  Fri: boolean;\n  Sat: boolean;\n  Sun: boolean;\n};\n\nexport const NO_DAYS_SET = {\n  Mon: false,\n  Tue: false,\n  Wed: false,\n  Thu: false,\n  Fri: false,\n  Sat: false,\n  Sun: false\n};\n\nexport const ALL_DAYS_SET = {\n  Mon: true,\n  Tue: true,\n  Wed: true,\n  Thu: true,\n  Fri: true,\n  Sat: true,\n  Sun: true\n};\n\nexport interface HabitType {\n  name: string;\n  days: DayToggles,\n  habit_id: string;\n  id: string;\n  status: boolean;\n  date: string;\n}\n\nexport interface HabitResponse {\n  current_dow: string;\n  habits: Array<HabitType>;\n}\n\ninterface NoteResponse {\n  note?: {\n    note: string\n  };\n}\n\ninterface HabitsType {\n  habits: Array<HabitType>; \n  empty: boolean;\n  currentDayOfWeek: string;\n  editing: boolean;\n  currentlyEditing?: HabitType;\n  setEditing: (editing: boolean, id: string | undefined) => Promise<void>;\n  load: () => Promise<void>;\n  create: (name: string, days: DayToggles) => Promise<void>;\n  update: (id: string, name: string, days: DayToggles) => Promise<void>;\n  del: (id: string) => Promise<void>;\n  set: (habits: HabitResponse) => {};\n  toggle: (id: string) => Promise<void>;\n  move: (oldIndex: number, newIndex: number) => Promise<void>;\n  // Notes CRUD:\n  note: string;\n  createNote: (note: string) => Promise<void>;\n  loadNote: () => Promise<void>;\n}\n\nconst HabitsContext = React.createContext<HabitsType>(null!);\n\nexport function HabitsProvider({ children }: { children: React.ReactNode }) {\n  const [habits, setHabits] = React.useState<Array<HabitType>>([]);\n  const [empty, setEmpty] = React.useState<boolean>(false);\n  const [currentDayOfWeek, setCurrentDayOfWeek] = React.useState<string>('');\n  const [editing, _setEditing] = React.useState<boolean>(false);\n  const [currentlyEditing, setCurrentlyEditing] = React.useState<HabitType | undefined>(undefined);\n  const [note, setNote] = React.useState<string>('');\n\n  const set = (habits: HabitResponse) => {\n    setHabits([...habits.habits]);\n    setEmpty(!habits.habits.length);\n    setCurrentDayOfWeek(habits.current_dow);\n    return {}\n  }\n\n  const create = async (name: string, days: DayToggles) => {\n    let hasDaysSet = false;\n    for (const toggle of Object.values(days)) {\n      if (toggle) hasDaysSet = true;\n    }\n    await fetch('/v1/habits', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({name, days: hasDaysSet ? days : undefined})\n    });\n  }\n\n  const update = async (id: string, name: string, days: DayToggles) => {\n    let hasDaysSet = false;\n    for (const toggle of Object.values(days)) {\n      if (toggle) hasDaysSet = true;\n    }\n    await fetch(`/v1/habits/${id}`, {\n      method: 'PUT',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({name, days: hasDaysSet ? days : ALL_DAYS_SET})\n    });\n  }\n\n  const del = async (id: string) => {\n    await fetch(`/v1/habits/${id}`, {\n      method: 'DELETE',\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    });\n  }\n\n  const toggle = async (id: string) => {\n    const habit = habits.find((h) => {\n      if (h.id === id) return true;\n    })\n    if (!habit) return;\n    await fetch('/v1/habits-daily', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        habit_id: habit.habit_id,\n        status: !habit.status,\n        date: habit.date,\n      })\n    });\n  }\n\n  const move = async (oldIndex: number, newIndex: number) => {\n    await fetch('/v1/habits/array-move', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        oldIndex,\n        newIndex\n      })\n    });\n  }\n\n  const load = async () => {\n    const resp = await fetch(\"/v1/habits-daily\");\n    const habits = await resp.json();\n    habits.habits.map((h) => {\n      h.id = h.habit_id;\n    });\n    set(habits);\n    await loadNote();\n  }\n\n  const setEditing = async (editing: boolean, id: string | undefined) => {\n    if (id) {\n      setCurrentlyEditing(habits.find(h => {\n        return h.id === id;\n      }));\n    } else {\n      setCurrentlyEditing(undefined);\n    }\n    _setEditing(editing);\n  }\n\n  // Add notes to your day that you can come back and reference in the future. Why did I have trouble making it\n  // to the gym on August 1st 2024?\n  const createNote = async (note: string) => {\n    await fetch('/v1/notes', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({note})\n    });\n  };\n\n  const loadNote = async () => {\n    const note: string = await fetch('/v1/notes/today', {\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    })\n    .then(resp => resp.json())\n    .then((resp: NoteResponse) => {\n      return resp.note ? resp.note.note : '';\n    });\n    console.info('setting note', note);\n    setNote(note);\n  };\n\n  const value = { habits, empty, currentDayOfWeek, editing, setEditing, currentlyEditing, load, set, create, update, del, toggle, move, note, createNote, loadNote };\n\n  return <HabitsContext.Provider value={value}>{children}</HabitsContext.Provider>;\n}\n\nexport function useHabits() {\n  return React.useContext(HabitsContext);\n}\n"],"names":["NO_DAYS_SET","ALL_DAYS_SET","HabitsContext","React.createContext","HabitsProvider","children","habits","setHabits","React.useState","empty","setEmpty","currentDayOfWeek","setCurrentDayOfWeek","editing","_setEditing","currentlyEditing","setCurrentlyEditing","note","setNote","set","create","name","days","hasDaysSet","toggle","update","id","del","habit","h","move","oldIndex","newIndex","load","loadNote","setEditing","createNote","resp","value","jsx","useHabits","React.useContext"],"mappings":"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"}