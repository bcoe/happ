{"version":3,"file":"metrics-DO-2CLz4.js","sources":["../../../app/providers/metrics.tsx"],"sourcesContent":["import * as React from \"react\";\n\nexport interface MetricType {\n  daily: Array<{\n    name: string;\n    completed: number;\n  }>\n}\n\nexport interface NoteTableRow {\n  note: string;\n  date: string;\n  highlight: boolean;\n}\n\ninterface MetricsType {\n  metrics: MetricType; \n  notes: Array<NoteTableRow>,\n  load: () => Promise<void>;\n  set: (metrics: MetricType) => void;\n  maybeSelectRow: (date: string) => void;\n  lostFocus: () => void;\n  gotFocus: () => void;\n}\n\nconst MetricsContext = React.createContext<MetricsType>(null!);\n\nexport function MetricsProvider({ children }: { children: React.ReactNode }) {\n  const [metrics, setMetrics] =  React.useState<MetricType>({daily: []});\n  const [notes, setNotes] = React.useState<Array<NoteTableRow>>([]);\n  const [selectedDate, setSelectedDate] = React.useState<string>('');\n  const [hasFocus, setHasFocus] = React.useState<boolean>(false);\n\n  const set = (metrics: MetricType) => {\n    setMetrics(metrics);\n    return {};\n  }\n\n  const loadNotes = async () => {\n    const resp = await fetch(\"/v1/notes\");\n    const n = await resp.json();\n    setNotes(n.map((n) => {\n      return {\n        note: n.note,\n        date: n.date,\n        highlight: false\n      }\n    }));\n  }\n\n  const load = async () => {\n    const resp = await fetch(\"/v1/metrics\");\n    const m = await resp.json();\n    set({daily: m.map((item) => {\n      const date = (new Date(item.date)).toISOString().split('T')[0];\n      return {\n        name: date,\n        completed: item.total_habits_for_day ? (item.habits_completed / item.total_habits_for_day) : 0\n      }\n    })});\n    await loadNotes();\n  }\n\n  const maybeSelectRow = async (date: string) => {\n    if (date === selectedDate || hasFocus === false) return;\n    else setSelectedDate(date);\n    if (date !== selectedDate) {\n      setNotes(notes.map((n) => {\n        return {\n          note: n.note,\n          date: n.date,\n          highlight: n.date === date\n        };\n      }))\n    }\n  };\n\n  const gotFocus = async () => {\n    if (hasFocus === true) return;\n    setHasFocus(true);\n  };\n\n  const lostFocus = async () => {\n    if (hasFocus === false) return;\n    else setHasFocus(false);\n    setSelectedDate('');\n    setNotes(notes.map((n) => {\n      return {\n        note: n.note,\n        date: n.date,\n        highlight: false\n      };\n    }));\n  };\n\n  const value = { metrics, notes, load, set, maybeSelectRow, gotFocus, lostFocus };\n\n  return <MetricsContext.Provider value={value}>{children}</MetricsContext.Provider>;\n}\n\nexport function useMetrics() {\n  return React.useContext(MetricsContext);\n}\n"],"names":["MetricsContext","React","MetricsProvider","children","metrics","setMetrics","daily","notes","setNotes","useState","selectedDate","setSelectedDate","hasFocus","setHasFocus","set","loadNotes","n","fetch","json","map","note","date","highlight","value","load","m","item","name","Date","toISOString","split","completed","total_habits_for_day","habits_completed","maybeSelectRow","gotFocus","lostFocus","jsx","useMetrics"],"mappings":"4WAyBA,MAAMA,EAAiBC,EAAAA,cAAiC,IAAK,EAEtD,SAASC,EAAgB,CAAEC,SAAAA,CAAwC,EAAG,CAC3E,KAAM,CAACC,EAASC,CAAU,EAAKJ,WAA2B,CAACK,MAAO,CAAA,CAAA,CAAG,EAC/D,CAACC,EAAOC,CAAQ,EAAIP,EAAMQ,SAA8B,CAAE,CAAA,EAC1D,CAACC,EAAcC,CAAe,EAAIV,WAAuB,EAAE,EAC3D,CAACW,EAAUC,CAAW,EAAIZ,WAAwB,EAAK,EAEvDa,EAAOV,IACXC,EAAWD,CAAO,EACX,IAGHW,EAAY,SAAY,CAEtBC,MAAAA,EAAI,MADG,MAAMC,MAAM,WAAW,GACfC,OACZF,EAAAA,EAAEG,IAAKH,IACP,CACLI,KAAMJ,EAAEI,KACRC,KAAML,EAAEK,KACRC,UAAW,EAAA,EAEd,CAAC,CAAA,EAgDEC,EAAQ,CAAEnB,QAAAA,EAASG,MAAAA,EAAOiB,KA7CnB,SAAY,CAEjBC,MAAAA,EAAI,MADG,MAAMR,MAAM,aAAa,GACjBC,OACjBJ,EAAA,CAACR,MAAOmB,EAAEN,IAAcO,IAEnB,CACLC,KAFY,IAAIC,KAAKF,EAAKL,IAAI,EAAGQ,YAAAA,EAAcC,MAAM,GAAG,EAAE,CAAC,EAG3DC,UAAWL,EAAKM,qBAAwBN,EAAKO,iBAAmBP,EAAKM,qBAAwB,CAAA,EAEhG,CAAA,CAAE,EACH,MAAMjB,EAAU,CAAA,EAmCoBD,IAAAA,EAAKoB,eAhCpB,MAAOb,GAAiB,CACzCA,IAASX,GAAgBE,IAAa,KACrCD,EAAgBU,CAAI,EACrBA,IAASX,GACFH,EAAAA,EAAMY,IAAWH,IACjB,CACLI,KAAMJ,EAAEI,KACRC,KAAML,EAAEK,KACRC,UAAWN,EAAEK,OAASA,CAAAA,EAEzB,CAAC,EACJ,EAqByDc,SAlB1C,SAAY,CACvBvB,IAAa,IACjBC,EAAY,EAAI,CAAA,EAgBmDuB,UAbnD,SAAY,CACxBxB,IAAa,KACZC,EAAY,EAAK,EACtBF,EAAgB,EAAE,EACTJ,EAAAA,EAAMY,IAAWH,IACjB,CACLI,KAAMJ,EAAEI,KACRC,KAAML,EAAEK,KACRC,UAAW,EAAA,EAEd,CAAC,EAAA,CAGiEc,EAE9D,OAAAC,EAAA,IAACrC,EAAe,SAAf,CAAwB,MAAAuB,EAAa,sBAAA,UAAA,wBAAA,kBAAA,0BAAA,cAAEpB,SAAAA,CAAS,CAAA,CAC1D,CAEO,SAASmC,GAAa,CACpBrC,OAAAA,EAAAA,WAAiBD,CAAc,CACxC"}